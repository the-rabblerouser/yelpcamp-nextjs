{"ast":null,"code":"import { MongoClient } from 'mongodb';\nconst {\n  MONGODB_URI,\n  MONGODB_DB\n} = process.env;\n\nif (!MONGODB_URI) {\n  throw new Error('Please define the MONGODB_URI environment variable inside .env.local');\n}\n\nif (!MONGODB_DB) {\n  throw new Error('Please define the MONGODB_DB environment variable inside .env.local');\n}\n/**\n * Global is used here to maintain a cached connection across hot reloads\n * in development. This prevents connections growing exponentially\n * during API Route usage.\n */\n\n\nlet cached = global.mongo;\n\nif (!cached) {\n  cached = global.mongo = {\n    conn: null,\n    promise: null\n  };\n}\n\nexport async function connectToDatabase() {\n  if (cached.conn) {\n    return cached.conn;\n  }\n\n  if (!cached.promise) {\n    const opts = {\n      useNewUrlParser: true,\n      useUnifiedTopology: true\n    };\n    cached.promise = MongoClient.connect(MONGODB_URI, opts).then(client => {\n      return {\n        client,\n        db: client.db(MONGODB_DB)\n      };\n    });\n  }\n\n  cached.conn = await cached.promise;\n  return cached.conn;\n}","map":{"version":3,"sources":["/Users/joemccann/Desktop/yelpcamp-nexjs/utils/mongodb.js"],"names":["MongoClient","MONGODB_URI","MONGODB_DB","process","env","Error","cached","global","mongo","conn","promise","connectToDatabase","opts","useNewUrlParser","useUnifiedTopology","connect","then","client","db"],"mappings":"AAAA,SAASA,WAAT,QAA4B,SAA5B;AAEA,MAAM;AAAEC,EAAAA,WAAF;AAAeC,EAAAA;AAAf,IAA8BC,OAAO,CAACC,GAA5C;;AAEA,IAAI,CAACH,WAAL,EAAkB;AACjB,QAAM,IAAII,KAAJ,CACL,sEADK,CAAN;AAGA;;AAED,IAAI,CAACH,UAAL,EAAiB;AAChB,QAAM,IAAIG,KAAJ,CACL,qEADK,CAAN;AAGA;AAED;AACA;AACA;AACA;AACA;;;AACA,IAAIC,MAAM,GAAGC,MAAM,CAACC,KAApB;;AAEA,IAAI,CAACF,MAAL,EAAa;AACZA,EAAAA,MAAM,GAAGC,MAAM,CAACC,KAAP,GAAe;AAAEC,IAAAA,IAAI,EAAE,IAAR;AAAcC,IAAAA,OAAO,EAAE;AAAvB,GAAxB;AACA;;AAED,OAAO,eAAeC,iBAAf,GAAmC;AACzC,MAAIL,MAAM,CAACG,IAAX,EAAiB;AAChB,WAAOH,MAAM,CAACG,IAAd;AACA;;AAED,MAAI,CAACH,MAAM,CAACI,OAAZ,EAAqB;AACpB,UAAME,IAAI,GAAG;AACZC,MAAAA,eAAe,EAAE,IADL;AAEZC,MAAAA,kBAAkB,EAAE;AAFR,KAAb;AAKAR,IAAAA,MAAM,CAACI,OAAP,GAAiBV,WAAW,CAACe,OAAZ,CAAoBd,WAApB,EAAiCW,IAAjC,EAAuCI,IAAvC,CAA6CC,MAAD,IAAY;AACxE,aAAO;AACNA,QAAAA,MADM;AAENC,QAAAA,EAAE,EAAED,MAAM,CAACC,EAAP,CAAUhB,UAAV;AAFE,OAAP;AAIA,KALgB,CAAjB;AAMA;;AACDI,EAAAA,MAAM,CAACG,IAAP,GAAc,MAAMH,MAAM,CAACI,OAA3B;AACA,SAAOJ,MAAM,CAACG,IAAd;AACA","sourcesContent":["import { MongoClient } from 'mongodb';\n\nconst { MONGODB_URI, MONGODB_DB } = process.env;\n\nif (!MONGODB_URI) {\n\tthrow new Error(\n\t\t'Please define the MONGODB_URI environment variable inside .env.local'\n\t);\n}\n\nif (!MONGODB_DB) {\n\tthrow new Error(\n\t\t'Please define the MONGODB_DB environment variable inside .env.local'\n\t);\n}\n\n/**\n * Global is used here to maintain a cached connection across hot reloads\n * in development. This prevents connections growing exponentially\n * during API Route usage.\n */\nlet cached = global.mongo;\n\nif (!cached) {\n\tcached = global.mongo = { conn: null, promise: null };\n}\n\nexport async function connectToDatabase() {\n\tif (cached.conn) {\n\t\treturn cached.conn;\n\t}\n\n\tif (!cached.promise) {\n\t\tconst opts = {\n\t\t\tuseNewUrlParser: true,\n\t\t\tuseUnifiedTopology: true,\n\t\t};\n\n\t\tcached.promise = MongoClient.connect(MONGODB_URI, opts).then((client) => {\n\t\t\treturn {\n\t\t\t\tclient,\n\t\t\t\tdb: client.db(MONGODB_DB),\n\t\t\t};\n\t\t});\n\t}\n\tcached.conn = await cached.promise;\n\treturn cached.conn;\n}\n"]},"metadata":{},"sourceType":"module"}